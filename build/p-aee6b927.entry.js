import{r as i,c as l,h as t}from"./p-8710117e.js";import{r as o}from"./p-370825cb.js";import"./p-86bd3473.js";import"./p-65879f9e.js";const n=class{constructor(t){i(this,t),this.fireenjinFetch=l(this,"fireenjinFetch",7),this.totallerIds=void 0,this.label=void 0,this.groupBy="month",this.timeframe=new Date,this.options=[],this.paths={},this.totals={}}async onSuccess(i){var l,t,o,n,s,e,d,v,a,h,r,u,c,f,p,m,j;if("findTotaller"===(null===(l=null==i?void 0:i.detail)||void 0===l?void 0:l.endpoint)){const l=null===(n=null===(o=null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.data)||void 0===o?void 0:o.totaller)||void 0===n?void 0:n.id;for(const[t,o]of Object.entries((null===(d=null===(e=null===(s=null==i?void 0:i.detail)||void 0===s?void 0:s.data)||void 0===e?void 0:e.totaller)||void 0===d?void 0:d.paths)||{}))this.paths[l]||(this.paths[l]={}),this.paths[l][t]=o,this.groupBy===t&&this.fetchTotals(l,o),this.options.includes(t)||this.options.push(t);this.options=[...this.options],this.paths=Object.assign({},this.paths),this.label||(this.label=(null===(h=null===(a=null===(v=null==i?void 0:i.detail)||void 0===v?void 0:v.data)||void 0===a?void 0:a.totaller)||void 0===h?void 0:h.name)||null)}else if("findTotals"===(null===(r=null==i?void 0:i.detail)||void 0===r?void 0:r.endpoint)){const l=null===(p=null===(f=null===(c=null===(u=null==i?void 0:i.detail)||void 0===u?void 0:u.event)||void 0===c?void 0:c.detail)||void 0===f?void 0:f.params)||void 0===p?void 0:p.totallerId;this.totals=Object.assign(Object.assign({},this.totals),{[l]:null===(j=null===(m=null==i?void 0:i.detail)||void 0===m?void 0:m.data)||void 0===j?void 0:j.totals})}}async fetchTotals(i,l,t){this.fireenjinFetch.emit({endpoint:"findTotals",params:{totallerId:i,path:this.renderPathTemplate(i,l,t)}})}async onChange(i){var l,t,o;"groupBy"===(null===(l=null==i?void 0:i.target)||void 0===l?void 0:l.name)&&(this.groupBy=null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.value);for(const l of this.totallerIds){const t=new Date(Date.parse(i.target.value));t.setHours(24),this.fetchTotals(l,this.paths[l][this.groupBy],"timeframe"===(null===(o=null==i?void 0:i.target)||void 0===o?void 0:o.name)?t:this.timeframe)}}renderPathTemplate(i,l,t){return o(l,{totaller:{id:i},data:{createdAt:t||new Date}})}render(){return[t("floodteam-title-bar",null,this.label||"",t("div",{slot:"end"},t("fireenjin-select",{style:{display:"none"},ref:i=>this.selectEl=i,label:"View By",labelPosition:"stacked",name:"groupBy",value:this.groupBy,options:(this.options||[]).map((i=>({label:i,value:i})))}),t("fireenjin-chip-bar",null,t("ion-chip",{onClick:()=>this.selectEl.querySelector("ion-select").click()},this.groupBy,t("ion-icon",{name:"chevron-down-circle"})),t("ion-chip",null,t("fireenjin-input",{"clear-on-edit":!0,name:"timeframe",type:"date",value:this.timeframe}))))),(this.totallerIds||[]).map((i=>{var l;return t("floodteam-totaller-cards",{totals:null===(l=this.totals)||void 0===l?void 0:l[i],totallerId:i})}))]}};export{n as floodteam_totaller_card_list}