import{r as t,c as i,B as s,h as e,H as o,d as n}from"./p-8710117e.js";import{D as r}from"./p-b767ca95.js";import{g as h}from"./p-b561825f.js";import{m as l}from"./p-31eabad9.js";import{u as a}from"./p-05e9b083.js";import{r as d,k as c}from"./p-1aa85997.js";import{a as u,g as p}from"./p-111fc34b.js";import{a as f,b as m,c as v}from"./p-604a7987.js";import"./p-86bd3473.js";import"./p-add30d46.js";import"./p-295f0cea.js";import"./p-9225a9b8.js";import"./p-924f3f49.js";import"./p-28e84784.js";const w=class{constructor(s){t(this,s),this.fireenjinFetch=i(this,"fireenjinFetch",7),this.disablePageCheck=!1,this.disableFetch=!1,this.display="list",this.page=0,this.results=[],this.loadingSpinner="bubbles",this.loadingText="Loading more data...",this.name="pagination",this.disableVirtualScroll=!1,this.removeDuplicates=!1,this.nextKey="id",this.paramData={}}onQuery(){this.infiniteScrollEl.disabled=!1,this.results=[],this.getResults({page:0})}onDisplay(){this.infiniteScrollEl.disabled=!1,setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}async onSuccess(t){if(t.detail.name===this.name){let i=[];try{i=this.resultsKey.split(".").reduce(((t,i)=>t[i]),t.detail.data)}catch(i){console.log("Error getting results",t.detail,this.resultsKey)}try{0===this.page&&(this.results=[]),this.page=this.pageKey?this.pageKey.split(".").reduce(((t,i)=>t[i]),t.detail.data):this.page,await this.addResults(i)}catch(t){console.log("Error updating results!")}await this.infiniteScrollEl.complete(),(!(null==i?void 0:i.length)||this.pageCountKey&&this.pageKey&&this.pageKey.split(".").reduce(((t,i)=>t[i]),t.detail.data)===this.pageCountKey.split(".").reduce(((t,i)=>t[i]),t.detail.data))&&(this.infiniteScrollEl.disabled=!0),this.disableVirtualScroll||(await this.virtualScrollEl.checkEnd(),setTimeout((()=>{window.dispatchEvent(new window.Event("resize"))}),200))}}onInfiniteScroll(){this.getResults({next:!0})}onResize(){var t,i;if(!this.disableVirtualScroll)if("list"===this.display&&(null===(t=this.virtualScrollEl)||void 0===t?void 0:t.querySelector("ion-item")))this.approxItemHeight=this.virtualScrollEl.querySelector("ion-item").offsetHeight;else if("grid"===this.display&&(null===(i=this.virtualScrollEl)||void 0===i?void 0:i.querySelectorAll("ion-col"))){let t,i;const s=this.virtualScrollEl.querySelectorAll("ion-col");for(t=0;t<s.length;t++){const e=s[t];if(i&&e.offsetTop!==i.offsetTop)break;i=e}i&&i.firstChild&&(this.approxItemHeight=i.firstChild.scrollHeight/t+18)}}async clearParamData(t){if(t&&this.paramData[t]){const i=this.paramData;delete i[t],this.paramData=i}else t||(this.paramData={});return this.infiniteScrollEl.disabled=!1,this.paramData}async addResults(t=[]){if(this.removeDuplicates){const i=t.map((t=>t.id));this.results=[...this.results.filter((t=>!i.includes(t.id))),...t]}else this.results=[...this.results,...t];this.infiniteScrollEl.disabled=!1}async clearResults(){this.page=0,this.results=[],this.infiniteScrollEl.disabled=!1}async getResults(t={}){var i,s,e;if(!this.disablePageCheck&&(null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.pathname)!==this.initailizedOnPath)return;(t.page||0===t.page)&&(this.page=t.page),t.next&&(this.page=this.page+1),this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:t.limit?t.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection,page:this.page}),(null==t?void 0:t.paramData)?t.paramData:{}),(this.query||""===this.query)&&(this.paramData.query=this.query),0===this.page&&(this.paramData.next=null,this.paramData.back=null),t.next&&(null===(s=this.results)||void 0===s?void 0:s.length)&&(null===(e=this.results[this.results.length-1])||void 0===e?void 0:e[this.nextKey])&&(this.paramData.next=this.results[this.results.length-1][this.nextKey]);const o=Object.assign(Object.assign({},this.fetchParams?this.fetchParams:{}),{data:Object.assign(Object.assign({},this.fetchData?this.fetchData:{}),this.paramData)});this.fireenjinFetch.emit({name:this.name,endpoint:this.endpoint,dataPropsMap:this.dataPropsMap?this.dataPropsMap:null,disableFetch:this.disableFetch,params:this.beforeFetch?await this.beforeFetch(o):o})}componentWillLoad(){(null==s?void 0:s.isBrowser)&&this.collection&&(this.resultsKey=this.resultsKey?this.resultsKey:`${this.collection}.results`,this.pageKey=this.pageKey?this.pageKey:`${this.collection}.page`,this.pageCountKey=this.pageCountKey?this.pageCountKey:`${this.collection}.pageCount`,this.resultCountKey=this.resultCountKey?this.resultCountKey:`${this.collection}.resultCount`,this.name=this.name?this.name:`${this.collection}Pagination`)}componentDidLoad(){var t,i;(null==s?void 0:s.isBrowser)&&((null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.pathname)&&(this.initailizedOnPath=window.location.pathname),this.disableVirtualScroll||(window.dispatchEvent(new window.Event("resize")),this.resizeInterval=setInterval((()=>{window.dispatchEvent(new window.Event("resize"))}),3e3)),(null===(i=this.results)||void 0===i?void 0:i.length)||this.getResults())}disconnectedCallback(){this.disableVirtualScroll||clearInterval(this.resizeInterval)}renderResults(){return"grid"===this.display?e("ion-grid",null,e("ion-row",null,this.results.map((t=>"string"==typeof this.gridEl({result:t},null,null)?e("ion-col",{innerHTML:this.gridEl({result:t},null,null)}):e("ion-col",null,this.gridEl({result:t},null,null)))))):this.listEl?e("ion-card",null,e("ion-list",null,this.results.map((t=>"string"==typeof this.listEl({result:t},null,null)?e("div",{innerHTML:this.listEl({result:t},null,null)}):this.listEl({result:t},null,null))))):this.results.map(((t,i)=>this.renderItem(t,i)))}render(){return e("div",{class:"pagination"},this.disableVirtualScroll?e("div",null,this.renderResults()):e("ion-virtual-scroll",{items:this.results,approxItemHeight:this.approxItemHeight,renderItem:this.renderItem,ref:t=>this.virtualScrollEl=t},(this.listEl||this.gridEl)&&this.renderResults()),e("ion-infinite-scroll",{style:{display:"block"},ref:t=>this.infiniteScrollEl=t},e("ion-infinite-scroll-content",{"loading-spinner":this.loadingSpinner,"loading-text":this.loadingText})))}static get watchers(){return{fetchData:["onQuery"],orderBy:["onQuery"],query:["onQuery"],display:["onDisplay"]}}};(function(t,i,s,e){var o,n=arguments.length,r=n<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(r=(n<3?o(r):n>3?o(i,s,r):o(i,s))||r);n>3&&r&&Object.defineProperty(i,s,r)})([r(1e3)],w.prototype,"onQuery",null),w.style="";const b=class{constructor(i){t(this,i),this.templateId=void 0,this.template=void 0,this.partials=void 0,this.data=void 0,this.helpers=void 0,this.zoom=1,this.resize=!1,this.allowFullscreen=!1,this.rawHtml=void 0,this.disablePosition=!1,this.disableFrame=!1}componentDidLoad(){try{this.templateEl.shadowRoot.querySelector(".contract-header").remove(),this.templateEl.shadowRoot.querySelector(".contract-footer").remove()}catch(t){console.log(t)}}render(){var t,i;const s=this.template||(null===(i=(t=this.partials||[]).find)||void 0===i?void 0:i.call(t,(t=>(null==t?void 0:t.id)===this.templateId))),o=this.helpers||{},n=(this.partials||[]).filter((t=>!!(null==t?void 0:t.partial))).map((t=>({html:(null==t?void 0:t.html)||"",id:(null==t?void 0:t.id)||null})));return e("fireenjin-render-template",{ref:t=>this.templateEl=t,disableFrame:!0,enableClicks:!0,template:s,templateId:this.templateId,data:this.data,helpers:o,partials:n,zoom:this.zoom,allowFullscreen:this.allowFullscreen,resize:this.resize,rawHtml:this.rawHtml,disablePosition:this.disablePosition})}},g=class{constructor(i){t(this,i),this.visible=!1,this.autoHide=!0,this.onClick=()=>l.toggle(this.menu)}connectedCallback(){this.visibilityChanged()}async visibilityChanged(){this.visible=await a(this.menu)}render(){const t=h(this),i=this.autoHide&&!this.visible;return e(o,{onClick:this.onClick,"aria-hidden":i?"true":null,class:{[t]:!0,"menu-toggle-hidden":i}},e("slot",null))}};g.style=":host(.menu-toggle-hidden){display:none}";const y=class{constructor(i){t(this,i)}onClick(t){const i=this.el.closest("ion-reorder-group");t.preventDefault(),i&&i.disabled||t.stopImmediatePropagation()}render(){const t=h(this);return e(o,{class:t},e("slot",null,e("ion-icon",{icon:"ios"===t?d:c,lazy:!1,class:"reorder-icon",part:"icon"})))}get el(){return n(this)}};y.style={ios:":host([slot]){display:none;line-height:0;z-index:100}.reorder-icon{display:block;font-size:22px}.reorder-icon{font-size:34px;opacity:0.4}",md:":host([slot]){display:none;line-height:0;z-index:100}.reorder-icon{display:block;font-size:22px}.reorder-icon{font-size:31px;opacity:0.3}"};const j=class{constructor(s){t(this,s),this.ionItemReorder=i(this,"ionItemReorder",7),this.lastToIndex=-1,this.cachedHeights=[],this.scrollElTop=0,this.scrollElBottom=0,this.scrollElInitial=0,this.containerTop=0,this.containerBottom=0,this.state=0,this.disabled=!0}disabledChanged(){this.gesture&&this.gesture.enable(!this.disabled)}async connectedCallback(){const t=u(this.el);t&&(this.scrollEl=await p(t)),this.gesture=(await import("./p-36a96731.js")).createGesture({el:this.el,gestureName:"reorder",gesturePriority:110,threshold:0,direction:"y",passive:!1,canStart:t=>this.canStart(t),onStart:t=>this.onStart(t),onMove:t=>this.onMove(t),onEnd:()=>this.onEnd()}),this.disabledChanged()}disconnectedCallback(){this.onEnd(),this.gesture&&(this.gesture.destroy(),this.gesture=void 0)}complete(t){return Promise.resolve(this.completeSync(t))}canStart(t){if(this.selectedItemEl||0!==this.state)return!1;const i=t.event.target.closest("ion-reorder");if(!i)return!1;const s=z(i,this.el);return!!s&&(t.data=s,!0)}onStart(t){t.event.preventDefault();const i=this.selectedItemEl=t.data,s=this.cachedHeights;s.length=0;const e=this.el,o=e.children;if(!o||0===o.length)return;let n=0;for(let t=0;t<o.length;t++){const i=o[t];n+=i.offsetHeight,s.push(n),i.$ionIndex=t}const r=e.getBoundingClientRect();if(this.containerTop=r.top,this.containerBottom=r.bottom,this.scrollEl){const t=this.scrollEl.getBoundingClientRect();this.scrollElInitial=this.scrollEl.scrollTop,this.scrollElTop=t.top+k,this.scrollElBottom=t.bottom-k}else this.scrollElInitial=0,this.scrollElTop=0,this.scrollElBottom=0;this.lastToIndex=x(i),this.selectedItemHeight=i.offsetHeight,this.state=1,i.classList.add(O),f()}onMove(t){const i=this.selectedItemEl;if(!i)return;const s=this.autoscroll(t.currentY),e=this.containerTop-s,o=Math.max(e,Math.min(t.currentY,this.containerBottom-s)),n=s+o-t.startY,r=this.itemIndexForTop(o-e);if(r!==this.lastToIndex){const t=x(i);this.lastToIndex=r,m(),this.reorderMove(t,r)}i.style.transform=`translateY(${n}px)`}onEnd(){const t=this.selectedItemEl;if(this.state=2,!t)return void(this.state=0);const i=this.lastToIndex,s=x(t);i===s?this.completeSync():this.ionItemReorder.emit({from:s,to:i,complete:this.completeSync.bind(this)}),v()}completeSync(t){const i=this.selectedItemEl;if(i&&2===this.state){const s=this.el.children,e=s.length,o=this.lastToIndex,n=x(i);o===n||void 0!==t&&!0!==t||this.el.insertBefore(i,n<o?s[o+1]:s[o]),Array.isArray(t)&&(t=R(t,n,o));for(let t=0;t<e;t++)s[t].style.transform="";i.style.transition="",i.classList.remove(O),this.selectedItemEl=void 0,this.state=0}return t}itemIndexForTop(t){const i=this.cachedHeights;for(let s=0;s<i.length;s++)if(i[s]>t)return s;return i.length-1}reorderMove(t,i){const s=this.selectedItemHeight,e=this.el.children;for(let o=0;o<e.length;o++){let n="";o>t&&o<=i?n=`translateY(${-s}px)`:o<t&&o>=i&&(n=`translateY(${s}px)`),e[o].style.transform=n}}autoscroll(t){if(!this.scrollEl)return 0;let i=0;return t<this.scrollElTop?i=-C:t>this.scrollElBottom&&(i=C),0!==i&&this.scrollEl.scrollBy(0,i),this.scrollEl.scrollTop-this.scrollElInitial}render(){const t=h(this);return e(o,{class:{[t]:!0,"reorder-enabled":!this.disabled,"reorder-list-active":0!==this.state}})}get el(){return n(this)}static get watchers(){return{disabled:["disabledChanged"]}}},x=t=>t.$ionIndex,z=(t,i)=>{let s;for(;t;){if(s=t.parentElement,s===i)return t;t=s}},k=60,C=10,O="reorder-selected",R=(t,i,s)=>{const e=t[i];return t.splice(i,1),t.splice(s,0,e),t.slice()};j.style=".reorder-list-active>*{transition:transform 300ms;will-change:transform}.reorder-enabled{user-select:none}.reorder-enabled ion-reorder{display:block;cursor:grab;pointer-events:all;touch-action:none}.reorder-selected,.reorder-selected ion-reorder{cursor:grabbing}.reorder-selected{position:relative;transition:none !important;box-shadow:0 0 10px rgba(0, 0, 0, 0.4);opacity:0.8;z-index:100}.reorder-visible ion-reorder .reorder-icon{transform:translate3d(0,  0,  0)}";export{w as fireenjin_pagination,b as floodteam_template,g as ion_menu_toggle,y as ion_reorder,j as ion_reorder_group}