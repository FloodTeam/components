import{r as i,c as t,B as s,h as e}from"./p-8710117e.js";const n=class{constructor(s){i(this,s),this.ionChange=t(this,"ionChange",7),this.fireenjinFetch=t(this,"fireenjinFetch",7),this.fireenjinTrigger=t(this,"fireenjinTrigger",7),this.disableFetch=!1,this.name="tags",this.placeholder="Select Tags",this.options=[],this.required=!1,this.duplicates=!1,this.disabled=!1,this.allowAdding=!1,this.limit=15,this.page=0,this.results=[],this.labelPosition="stacked",this.addIcon="add-circle",this.hasValue=!1,this.paramData={}}async onSuccess(i){var t,s,e;if("selectTags"===i.detail.name)try{0===this.page&&(this.results=[]),this.page=(null===(e=null===(s=null===(t=i.detail)||void 0===t?void 0:t.data)||void 0===s?void 0:s.results)||void 0===e?void 0:e.page)?i.detail.data.results.page:this.page+1,await this.addResults(i.detail.data.results)}catch(i){console.log("Error updating results!")}}async onKeyDown(i){var t,s;if("Enter"===i.key&&this.allowAdding&&(null===(s=null===(t=i.target)||void 0===t?void 0:t.value)||void 0===s?void 0:s.length)>=1){const t=i.target.value.toLocaleLowerCase();this.addTag(t,i)}}async clearParamData(i){if(i&&this.paramData[i]){const t=this.paramData;delete t[i],this.paramData=t}else i||(this.paramData={});return this.paramData}async addResults(i=[]){this.results=[...this.results,...i],this.options=this.results.map((i=>({label:i.label?i.label:i.name?i.name:i.id?i.id:null,value:i.value?i.value:i.id?i.id:null})))}async clearResults(){this.page=0,this.results=[]}async addTag(i,t){if(!(null==i?void 0:i.length))return;const s=i.toLocaleLowerCase();s.length&&(this.fireenjinTrigger.emit({name:"newTag",payload:{value:s}}),(this.value||[]).includes(s)||(this.options=[...this.options?this.options:[],{label:s,value:s,selected:!0}]),this.addValue(s,t),this.query=null,this.inputEl&&(this.inputEl.value=null))}async getResults(i={}){var t,s,e;this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:i.limit?i.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection}),(null==i?void 0:i.paramData)?i.paramData:{}),i.page&&(this.page=i.page),(null===(t=this.query)||void 0===t?void 0:t.length)>1&&(this.paramData.query=this.query),(null===(s=this.results)||void 0===s?void 0:s.length)&&(null===(e=this.results[this.results.length-1])||void 0===e?void 0:e.id)&&(this.paramData.next=this.results[this.results.length-1].id),this.fireenjinFetch.emit({name:"selectTags",endpoint:this.endpoint,dataPropsMap:this.dataPropsMap?this.dataPropsMap:this.resultsKey?{[this.resultsKey]:"results"}:null,disableFetch:this.disableFetch,params:{data:this.fetchData?this.fetchData:this.paramData}})}async addValue(i,t){this.value=[...new Set([...this.value?this.value:[],i])],this.ionChange.emit({event:t,name:this.name,value:this.value})}async removeValue(i,t){this.value=(this.value||[]).filter((t=>t!==i)),this.ionChange.emit({event:t,name:this.name,value:this.value})}async updateOptionsForValue(){const i=(this.options||[]).map((i=>null==i?void 0:i.value));for(const t of this.value)i.includes(t)||this.options.push({label:t,value:t});this.options=[...this.options]}componentDidLoad(){var i;if(null==s?void 0:s.isBrowser){if(this.endpoint&&this.getResults(),!this.itemEl||!this.itemEl.shadowRoot)return!1;this.itemEl.shadowRoot.querySelector(".input-wrapper").style.overflow="visible",(null===(i=this.value)||void 0===i?void 0:i.length)&&this.updateOptionsForValue()}}render(){return e("ion-item",{ref:i=>this.itemEl=i,lines:this.lines},this.label&&e("ion-label",{position:this.labelPosition},this.label),this.allowAdding&&e("ion-input",{ref:i=>this.inputEl=i,value:this.query}),e("div",{class:"options-wrapper"},e("fireenjin-chip-bar",null,this.allowAdding&&e("ion-chip",{class:"add-tag",onClick:i=>{var t;return this.addTag(null===(t=this.inputEl)||void 0===t?void 0:t.value,i)}},"Add",e("ion-icon",{name:this.addIcon})),(this.options||[]).map((i=>e("ion-chip",{outline:!(this.value||[]).includes(null==i?void 0:i.value),onClick:t=>(this.value||[]).includes(null==i?void 0:i.value)?this.removeValue(null==i?void 0:i.value,t):this.addValue(null==i?void 0:i.value,t)},(null==i?void 0:i.label)||"",(this.value||[]).includes(null==i?void 0:i.value)&&e("ion-icon",{name:"close-circle"})))))))}};n.style="fireenjin-select-tags{display:block;overflow:visible !important;position:relative;z-index:9}fireenjin-select-tags ion-label{align-self:unset !important;color:var(--ion-text-color, #000);font-size:12px;font-weight:bold;font-family:arial;display:inline-block;background:transparent;text-align:left;padding:2px 35px 8px 0;font-family:var(--ion-font-family);color:var(--ion-text-color, #000) !important}fireenjin-select-tags .invalid{--border-color:var(--ion-color-danger) !important}fireenjin-select-tags .invalid ion-label{color:var(--ion-color-danger) !important}fireenjin-select-tags .valid{--border-color:var(--ion-color-success) !important}fireenjin-select-tags .valid ion-label{color:var(--ion-color-success) !important}fireenjin-select-tags ion-item{--background:transparent !important}fireenjin-select-tags .options-wrapper{height:50px}fireenjin-select-tags fireenjin-chip-bar{position:absolute;left:0;right:0;bottom:0;height:50px}";export{n as fireenjin_select_tags}