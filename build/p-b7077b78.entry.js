import{r as t,c as i,B as n,h as o}from"./p-8f2d27d2.js";async function s(t,i,n=500){return new Promise((async(o,a)=>{i&&"function"==typeof i||a("Callback function is required!");try{o(i())}catch(o){t>1?(await(e=n,new Promise((t=>setTimeout(t,e)))),s(t-1,i,2*n)):a(o)}var e}))}let a=class{constructor(n){t(this,n),this.fireenjinFetch=i(this,"fireenjinFetch",7),this.data={},this.template={},this.html=""}async componentWillLoad(){var t;(null==n?void 0:n.isBrowser)&&((null===(t=window)||void 0===t?void 0:t.Handlebars)||await async function(){return new Promise(((t,i)=>{const n=document.createElement("script");n.async=!0,n.src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js",n.addEventListener("load",t),n.addEventListener("error",(()=>i("Error loading script."))),n.addEventListener("abort",(()=>i("Script loading aborted."))),document.head.appendChild(n)}))}(),this.templateId&&this.fireenjinFetch.emit({endpoint:"findTemplate",params:{id:this.templateId}}))}componentDidLoad(){s(10,this.renderTemplate.bind(this)),this.setPartials(this.partials)}async setPartials(t){this.partials=(null==t?void 0:t.length)&&t||[];for(const t of this.partials)if(t.html)try{window.Handlebars.registerPartial(t.id,t.html)}catch(i){console.log(`Failed to load partial: ${null==t?void 0:t.id}`,t)}}async renderTemplate(){var t,i;this.html=window.Handlebars.compile((null===(t=this.template)||void 0===t?void 0:t.html)?null===(i=this.template)||void 0===i?void 0:i.html:"")(this.data?this.data:{})}onSuccess(t){var i,n,o,s,a,e;"findTemplate"===(null===(i=null==t?void 0:t.detail)||void 0===i?void 0:i.endpoint)&&(null===(s=null===(o=null===(n=t.detail)||void 0===n?void 0:n.data)||void 0===o?void 0:o.template)||void 0===s?void 0:s.id)===this.templateId&&(this.template=(null===(e=null===(a=null==t?void 0:t.detail)||void 0===a?void 0:a.data)||void 0===e?void 0:e.template)?t.detail.data.template:null)}onTemplateId(){this.fireenjinFetch.emit({endpoint:"findTemplate",params:{id:this.templateId}})}onData(){s(10,this.renderTemplate.bind(this))}onTemplate(){s(10,this.renderTemplate.bind(this))}onPartials(){this.setPartials(this.partials)}render(){return o("div",{innerHTML:this.html})}static get watchers(){return{templateId:["onTemplateId"],data:["onData"],template:["onTemplate"],partials:["onPartials"]}}};export{a as fireenjin_render_template}